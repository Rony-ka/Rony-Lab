<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Rotation Grid</title>
    <style>
        /* style.css */
        html, body {
            margin: 0;
            margin-top: -5px;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        body {
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(20px, 1fr));
            grid-template-rows: repeat(auto-fill, minmax(45px, 1fr));
            width: 100vw;
            height: 100vh;
            box-sizing: border-box;
            padding: 0px;
            overflow: hidden;
        }

        .line {
            width: 100px;
            height: 100px;
            margin-left: -40px;
            margin-right: -40px;
            margin-top: -10px;
            margin-bottom: -10px;
            transform-origin: center center;
            transition: transform 1s ease-out;
            --line-rotation: 0deg;
            transform: rotate(var(--line-rotation)) scaleX(1.2);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .line::before {
            content: '';
            background-color: #000000;
            width: 1px;
            height: 45px;
        }
    </style>
</head>
<body>
    <div id="grid-container"></div>

    <script>
        // script.js
        document.addEventListener('DOMContentLoaded', () => {
            const gridContainer = document.getElementById('grid-container');

            const actualGridRowHeight = 80;
            const actualGridColWidth = 9;

            const spinSpeed = 20000;
            const easeOutDelay = 2000;
            const lineThickness = 1.2;

            const lineStates = new Map();
            const lineTimeouts = new Map();

            const clearAllLineAnimations = () => {
                lineStates.forEach(state => {
                    if (state.animationFrameId) {
                        cancelAnimationFrame(state.animationFrameId);
                    }
                    state.isActive = false;
                    state.animationFrameId = null;
                });
                lineTimeouts.forEach(timeoutId => clearTimeout(timeoutId));
                lineTimeouts.clear();
                lineStates.clear();
            };

            const populateGrid = () => {
                clearAllLineAnimations();
                gridContainer.innerHTML = '';

                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                const rowsThatFit = Math.floor(viewportHeight / actualGridRowHeight);
                const colsThatFit = Math.ceil(viewportWidth / actualGridColWidth);

                const numLinesToCreate = rowsThatFit * colsThatFit;

                for (let i = 0; i < numLinesToCreate; i++) {
                    const line = document.createElement('div');
                    line.classList.add('line');
                    gridContainer.appendChild(line);

                    lineStates.set(line, {
                        currentRotation: 0,
                        isActive: false,
                        animationFrameId: null,
                        lastTime: performance.now()
                    });

                    line.addEventListener('mouseover', () => {
                        if (lineTimeouts.has(line)) {
                            clearTimeout(lineTimeouts.get(line));
                            lineTimeouts.delete(line);
                        }

                        const state = lineStates.get(line);
                        if (!state.isActive) {
                            state.isActive = true;
                            state.lastTime = performance.now();
                            const animateLineSpin = (currentTime) => {
                                if (!state.isActive) {
                                    state.animationFrameId = null;
                                    return;
                                }

                                const deltaTime = currentTime - state.lastTime;
                                state.currentRotation += (spinSpeed * (deltaTime / 1000));
                                state.currentRotation %= 360;

                                line.style.setProperty('--line-rotation', `${state.currentRotation}deg`);
                                line.style.transform = `rotate(${state.currentRotation}deg) scaleX(${lineThickness})`;

                                state.lastTime = currentTime;
                                state.animationFrameId = requestAnimationFrame(animateLineSpin);
                            };
                            state.animationFrameId = requestAnimationFrame(animateLineSpin);
                        }
                    });

                    line.addEventListener('mouseout', () => {
                        const state = lineStates.get(line);
                        if (state.isActive) {
                            state.isActive = false;
                            if (state.animationFrameId) {
                                cancelAnimationFrame(state.animationFrameId);
                                state.animationFrameId = null;
                            }

                            const timeoutId = setTimeout(() => {
                                line.style.setProperty('--line-rotation', '0deg');
                                line.style.transform = `rotate(0deg) scaleX(${lineThickness})`;
                                lineTimeouts.delete(line);
                            }, easeOutDelay);

                            lineTimeouts.set(line, timeoutId);
                        }
                    });
                }
            };

            populateGrid();

            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(populateGrid, 200);
            });
        });
    </script>
</body>
</html>